## 家政用户（365）平台

实名认证(人脸识别)

未认证 -> 浙里办下载 -> 激活 -> 采集人脸 -> 我的授权

身份证信息 居住证户口信息

## 后台管理系统

应用管理

API 管理

授权配置管理

场景数据管理

## 浙教钉

目标： 跨组织找人难，拆分 g/b/c 端，线下业务移植到线上，享受大数据的便利，便于沟通和监管

1. 选择嫁接浙政钉通讯录和钉钉家校通讯录的页面
2. 基于大数据，识别不同的用户画像

3. 通讯录
4. 用户中心  
   平台化？/产品化？
   家庭医生 医共体
5. 应用中心

一期 MVP 内容 TODO:

1. 后台管理

- 用户管理中心
  - 组织绑定：教育部门和学校管之间的绑定
- 应用管理中心
  - 应用管理：钉钉上架应用管理
  - 门户管理：不同地区范围显示不同门户内容

2. 浙教钉通讯录  
   教育厅-学校-人员树结构

金华和衢州 用户中心

## 开放域

政府内部数据开放到社会

DONE:

1. 后台管理联调

2. 钉钉 h5 静态

流程  
政务钉钉 通过免登 api 获取 coed => 传递 authCode 验证权限 => h5 应用内部

本周工作  
修复 bug，整理下一期的页面内容  
下周工作  
根据设计稿做静态页面

# 后台管理中心

1. 组织节点装卸到浙教钉
2. 组织/员工查看
   组织节点查看  
   家校通讯录查看  
   员工查看（不包括学生家长）
3. 接口权限页面（入口为应用管理）

树不重新加载 递归树更改当前节点的状态 例：解绑后两侧树状态更改。遍历左右两棵树的对应节点更改其状态，重新赋值；挂载。遍历右侧节点及其子节点更改其绑定关系，重新赋值，教钉找到对应节点增加其子节点并更改其状态；删除：最复杂，两侧数据重新请求？；找不到就算了  
重点：返回状态前不能点击树结构  
子节点有绑定关系 不支持挂载  
接口权限不能全部为空，范围必选  
横向样式变形？加一个长点的宽度

## 银保监

银行 => 银保监（金综） => 数浙（合规检查:脱敏） => 公共数据平台

pages  
应用管理
第三方来源管理
来源 API 列表  
出口 API 列表  
脱敏

TODO:
应用管理列表
添加脱敏字段，新增和编辑添加分步
抽象分步对话框
table 中的 expandedRowRender 字段可以自定义收缩的扩展内容
第三方来源管理 列表增改查页面  
脱敏服务 列表增改查页面 详情页需要按类型显示不同规则

权限管理
菜单管理
项目管理

step2
mainCombine(外层树)

modal(新增)
按钮选择
mainCombine(内层树)

modal(编辑)
mainCombine(内层树)

10 号前部署一套 前置依赖

会议纪要

1. 函数组件和类组件的区别，render props，hoc 高阶组件，hooks
2. 链表：单向、双向、环状链表，通过链表结构可以使 fiber 的增删效率更高
3. react 采用 current 树和 workInProgress 树作为当前和下一帧计算的树，双缓存机制可以使页面不白屏
4. hooks 的优势：更优雅的抽离业务逻辑
5. fiber，hooks，react 更新机制源码解析
6. hooks 最佳实践
7. 坏代码的味道
8. useForm 代码实现
9. szzj/hooks 作为一个前端库共同维护使用，推荐以@umijs/plugin-model 的方式公用

### OTS 加密

健康码加密

dfh-op-pc 后台管理系统，以及合作方微应用开发

浙教钉参与开发后台管理系统以及小程序 h5 应用开发

银保监脱敏项目

井冈山项目 G 端独立开发，以及 B 端和大屏项目辅助开发

疫情防控项目 PC+APP 两端，以及健康码小程序辅助开发

除了井冈山项目的 G 侧是从头到尾独立开发，其它项目大多是扮演中期介入到后期托底承接的角色

1. 公司架构，使命，愿景
   平台赋能政府、企业、群众以数字化能力
2. 防疫系统业务知识

3. 自我介绍
   来到数浙两年半了，先是参与网关、合作方、脱敏的后台管理系统的开发，然后辗转浙教钉、井冈山、疫情防控项目。

4. 项目总结
   井冈山 G 端：权限系统，政策及细则的制定，政策拆解到原子条款，政策推演
   权限系统：有超管、部门管理员、普通用户三个基准角色类型，给角色一个命名和描述，比如测试超管，然后会展示树状的菜单，在上面勾选确认后即确认了角色的页面权限范围。最后把创建的角色赋予给用户。
   菜单管理：每一个菜单可视为一条数据，有表示顺序的序号、路由、是否启用的状态、是否新窗口打开、是否外链等属性，一级菜单和二级菜单形成父子关系。
   政策和细则既支持上传也支持手动生成，拆解成原子条款后，逐个匹配对应的奖励，也可以在政企匹配中全局匹配
   政策推演：将满足条件的细则测算，推演覆盖的企业数和奖励数额，其中奖励条件的推演是类似 sql 语句的生成，需要指标、操作符和条件数值，也可以模拟首次达、排除等组合条件
   一些统计报表，比如根据政策查兑付的企业数和金额，或者根据企业查兑付的次数和金额

难点：政策推演的编辑
首先需要分四步走
其次需要手动实现一个平铺的树状列表，每一条匹配规则分单独匹配和组合匹配，单独匹配中不同的指标对应不同的操作符条件，不同的指标和操作符又对应不同的条件数值，组合匹配又是一个平铺的组合，比如营业额在 2022 年首次到达 1000 万，需要指标匹配+时间匹配，且还要进行完整性校验，至少一条，如果是空的匹配则忽略
因为匹配的规则繁杂琐碎，为了方便，在进步骤前转换成前端格式，提交给后端前再转换成后端格式，这样也不用担心后端随时改字段

防疫系统的难点：高频迭代导致的逻辑变动频繁，比如协查相关的字段在协查模块、病例管理、重点人员中都用到了，抽象成单独的组件放到 entities 下，作为业务组件公用，对业务模块集中管理；
历史债：导致多套方案同时存在，既有后端也有前端
两端公用：抽象公用逻辑的组件库

例子：弹窗添加 debounce，先是考虑弹窗控制的 useModal 能否添加，再考虑请求 useAsync, useFetch 上能否添加，最后万事不决加抽象，在 antd 的 Modal 上加一层封装，单独对提交的 onOk 函数 debounce 处理，为了严谨考虑，因为 Modal 上可以改变 footer 按钮，所以还要全局搜索看有没有自定义的按钮，最后还要把 Modal 上的静态方法注入上去

3. 职业规划

站在公司的角度需要什么样的技术能力，大屏、地图？

4. 主营业务

平台赋能政府、企业、群众以数字化能力

余杭一体化工作台

- 首页
  - 轮播条
  - 待办中心 （不同第三方来源的待办事项，可跳转处理）
  - 我的日程 （日程管理，发起、接收、拒绝、修改、取消会议，可签到）
  - 数据看板 （第三方静态页面）
  - 智能提醒 （退休人员出院、企业外迁两种智能提醒）
  - 查数据 （可通过企查查或企业综合服务平台查企业，加了权限控制；跳转已申请数据的详情页）
  - 进应用 （应用分类展示，可跳转）
  - 快捷入口（第三方快捷跳转）
- 街道数据资源 （数据资源申请、审批）
  专题数据：申请部门员工 => 申请部门领导审批通过 => 数管办审批通过 => 已申请数据列表页
  自有数据：申请部门员工 => 申请部门领导审批通过 => 数源单位审批通过 => 数管办审批通过 => 已申请数据列表页
- 我的数据
  - 已申请数据：
  - 自有数据：上架、下架自有数据
- 权限管理
  - 用户管理 （给用户赋予角色）
  - 角色管理 （给角色赋予权限，给单个角色批量设置用户）
  - 权限管理 （菜单配置，给菜单配置权限）

问题复现

1. 打包后的文件设置 publicPath 和 sourceMap 后部署在 Oss 上
2. IRS 上部署的 html 加载指向 Oss 上的 umi.js
3. 日程牵头部门 DeptTransferTextarea 在 onChange 中调用 form.setFieldsValue({ deptCodes }) 会卡死，无法进行任何操作，且无报错;
   发起部门的 onChange 中调用 form.setFieldsValue({ deptCodes })不会卡死，但是如果参会部门有值，再去调用 setFieldsValue 就会卡死；
   小结：form.setFieldsValue({ deptCodes }) 在 deptCodes 有树节点的值时，会卡死
4. 断点显示在 react-dom 的 accumulateSinglePhaseListeners 函数中死循环；
   推测：可能是在事件分发过程中，如果事件监听器在触发期间又修改了组件树或触发了其他事件，导致死循环
5. 去除掉所有多余的表单字段，断点调试 发现 rc-util 的 merge 也会死循环，把 DeptTransfer 的多余字段都删了，clone 的时候就不会死循环

尝试解决：

1. 改变 deptCodes 值
2. setTimeout
3. 只留发起部门和参会部门
4. react 版本
5. rc-util 的 merge 方法死循环，减少 clone 字段 (成功)

   2023.8.7-2023.8.11

6. 待办来源加上统计值（8.8 已发布）
7. irs 虚拟部署 (测试环境已替换，正式环境待下次发布时替换)
8. 增加浙政钉扫码页，逻辑改造后便于浏览器环境端远程调试 oss 部署代码
9. oss 部署：日程回复时，添加非浙政钉人员无效；发现其表单值没有更新，使用手动重绘组件更新后解决
10. 一体化工作台 PC 端和移动端埋点，统计各模块访问量
11. 代码优化：用 keep-alive 公共组件包裹进行缓存，但是因为 Modal 是通过 createProtal 挂载在 document.body 下，而不在 Provider 下，无法消费共享数据，所以该优化暂延
12. 代码优化：下载用 @szzj/utils 和 @szzj/request 替换，库的实现逻辑还有问题

    2023.8.14-2023.8.18

13. 埋点发布（8.17），pc 和移动端已从 irs 部署改成 oss 部署
14. utils 组件库增加 tree 的操作方法和其单元测试
15. 代码优化：文件流下载用 AttachmentMiddleware 替换
16. hooks 库中 filter 方法 bugfix，并添加单元测试

    2023.8.21-2023.8.27

17. 授权端：授权列表模块开发；页面适老化；
18. 基层工作台 PC 端: 日程优化；市民卡核验；简道云对接；
19. 基层工作台移动端: 日程优化；
20. Op 端：授权运营申请详情模块开发；

    2023.8.28-2023.9.1

21. 授权域 op、授权端项目联调、bugix

OP：切换 Hosts 网关登陆（地址 a）后，获取 cookie，切换回本地代理（地址 a），浏览器（地址 a+代理服务器端口）访问
授权端：

问题：

1. 切换 tab 导致列表页回到待授权列表 usePageShow 换成 useEffect
2. 详情样式有问题 className 不会自动转成驼峰类
3. 跳转人脸识别

4. Op 端 证件 PDF 预览
5. Op 端 字段更新
6. 浙里办授权联调

7. 扫脸后跳转结果页，但是不带 url 参数
8. 人脸识别失败后唤不起人脸识别  
   2.1 登陆人脸识别失败，如何再次唤起
   2.2 人脸识别必须先要有实名认证，如果没有实名认证？

9. 基层智治平台优化，具备上线条件
10. 授权端优化

11. 基层工作台残疾人模块，人员离开部门判断
12. IAM 页面开发

issues:

1. 文件预览
2. 统计时间

左三

1. 后三个异常待补充
2. 前三个详情页待补充
3. 后两个列表待联调
4. 列表页优化

5. 一本账新增用户管理模块，扫码登陆的参数从后端获取
6. IAM 开发联调省重点接口管理模块和对账中心模块

7. jest 断点调试
8. immer 源码：如何实现对象的代理
9. Tree 组件内部如何用 immer 实现树的不可变

```ts
const baseTree = new Tree(data);
baseTree;
```

4. 树的不可变（有什么意义？保留历史回溯？）

1. jest 断点调试 immerjs 源码
1. 一本账文件下载联调
1. 授权域发布

1. 杭宁温权限隔离
1. header 头里加 DATA-RANGE
1. tree-utils 提高单元测试覆盖率
1. tree-utils 文档说明
1. 一本账异常处置，看能不能统一放到公用组件库

1. @ant-design/icons 要指定 v4 版本安装，否则会报异常

1. 异常列表进入查看
1. 权限控制
1. 文件上传
1. 文件回显和下载

1. 首页格式对齐
1. 详情优化

1. cdn 替换成本地资源打包

1. 移动端发布
1. pc 端上浙政钉
1. 调研 @ant-design/charts
1. 调用 g6
1. 调研 @antv/graphin
1. EditableDetail 梳理

1. 一本账图表需求上线
1. 一本账网页端优化 js 缓存
1. 基层工作台 bugfix

1. 文件上传可多个
1. 文件下载是压缩包
1. 文件列表可单独下载
1. 基层工作台的通知应该请求 pc 端资源

p1: 移动端和 pc 端的异常流转增加异常状态，pc 端新增全省超期异常概览页
p2: 处置流程描述优化

1. zzd 移动端 h5 组件
2. 两端剥离
3. 首页优化

4. 大汉源码未提供
5. 完全自定义的工作台如何实现可见范围？
6. 文档说明太少，需要账号登录开发后台，看看具体有哪些功能
7. 自定义组件如何发布、上架、设置同 3
8. 技术选型：原生小程序+antd-mini or h5 应用开发？

9. monorepo?
10. 不支持日历。 原生? rax?

11. 组件化工作台在测试条线跑通
12. 禅道入门培训

TODO: 组件的 url 跳转和日程的标签

移动端工作台流程 TODO

1. 移动端正式环境发布
2. 测试
3. 工作台组件申请发布，曙光配置上线
4. 上线 zzd，内部台线测试
5. 上正式环境

镇街数据仓

1. 产品详情页: Header、Tabs、DataModel、ApplyModal
2. 迁移我的申请、我的审批
3. 权限中心参考组件 http://10.145.11.75:8080/gui/szzj-components#/components/field-list
4. zzd 部署

x6 思路
根据数据源结构转换成树
用 React 节点注册形状 或 注册自定义节点
如何放置位置？w:固定, h: 根据数据长度计算, x:固定加, y: 根据数据层级和高度加
连接边
收缩功能看情况加

TODO: 移动端

1. 正式环境发一版调试
2. 资讯专有钉钉上测试
3. 全部发布正式环境
4. 不能拖动 graph 上的 label
5. 生产环境如何区分测试还是生产, 用户白名单体系区分 dev 和 prod

6. 移动端优化版本开发完成（测试中）
7. 资讯组件开发完成（走上线流程中）
8. 周二发布移动端优化版
9. 剥离数据仓（联调中），周三提测、周五发布

10. 数据仓 bugfix、代码优化
11. 数据产品-退伍军人及其转入一表通
12. openPage 唤起人员信息

13. 新增退役军人重点优抚对象核验的数据产品
14. 一表通专区开发联调
15. 基层工作台首页栅格布局
16. 基层工作台首页组件化配置页

### 一表通

1. 一表通数据来源：一表通转入（定制）和原始维护的表数据（模板）
2. 模板：
   报送统计：区级数据范围有统计组件、列表、columns、上报、导出
   核验：columns（同当月）、上报、批量导入、单条增删改
3. 定制（退役军人）：
   报送统计：列表、columns、上报、导出 table、columns、toolbar
   核验：columns（同当月）、确认、批量确认、导出 table、columns、toolbar、actions

3.20

1. 基层工作台埋点验证
2. 数据仓 pc、移动端优化迭代
3. 一本账监管规则阈值修改的开发

# 空间

数据提供方
平台运营方
数据需求方
信息主体
配套服务
监管端

1. 大脑一本账联调
2. 监管一本账 bugfix
3. 数据仓优化迭代
4. 监管一本账添加 release 脚本
5. 数据治理项目熟悉

6. 省级治理发布
7. 苏州目录联调
8. 数据标准对接用户中心改造

用户中心 组件管理和 irs

1. 账密登录，手机号作为账号，显隐密码，加密传输
2. 修改密码
   5.9 号上纯测试，5.16 上正式

            数据供需--
                      |
数源单位 => 数据探查 <=> 数据目录 <=> 数据归集 => 数据治理 => 数据共享

数据供需是需求部门提需求
数源单位接收到该需求后，如果同意，就去建个目录并且关联起来
数据归集：从上游的数据目录更新的目录信息，发起采集、整合数据，减少重复收集
数据治理：根据治理工单治理、清洗数据
数据共享在共享库建表后，数开按规则加工数据同步到共享库
数据共享生成接口，对外使用
  前置库：归集工单通过后在前置库创建表，数源单位从生产库同步数据到前置库，前置库在生产库和部门归集仓中起中间人的作用，能清楚的追溯数据交换的方式以及交换的内容
  归集仓：同步各部门的前置库
  清洗库：数据治理的核心。同步归集仓，按照业务需要打标清洗，生成可用数据
  数管中心：批量授权的中心，所有共享数据都要经过数管中心
  应用仓：审核通过后的数据自动存到申请的应用仓中，数据需求方可在应用仓中对数据进行清洗、融合等工作，但无法导出数据，导出需要走导出流程
  共享库：开发生成数据的接口，同步到共享库

高铁（需求少）
标准（枚举源）
治理（目录和归集是它的上游）
坑 1: jstz 的 x6 和 x6-react-shape 是 v2 版本,其他都是 v1 版本; 有空再做升级，测试需回归
坑 2: 本地 chrome 有缓存,需要换成无痕模式或换个浏览器
antv/X6
大脑一本账
法人库
DSM
技术中台

分支规范
jssz/dev                     开发分支
jssz/test                    测试分支
jssz/pre                     预发分支
jssz/master                  交付分支
jssz/feature/20240511_xxx    功能分支
jssz/hotfix/20240511_fixCode 修复分支

因只有两个环境，所以只采用 pre 作为开发分支，master 作为交付分支，其他的功能和修复分支都从 master 分支拉，开发完成后合并到 pre 分支
如果有本地开发环境，则用 jssz/dev 作为本地开发分支
以苏州目录为例，如果流水线到部署没有问题，再替换到别的项目.

### 苏州目录

1. 目录分类（按主题）映射
2. 保存、提交
3. 区域字段
4. 共享条件不再填写说明
5. 新增和草稿态去掉两个编码

6. 批量设置权威数据
7. 批量设置隐藏或显示

### 陕西目录

1. 目录编辑-敏感级别

### 泰州治理

5.16
陕西治理部署
标准系统部署

# 部署

## 陕西

生产环境，需传包后执行脚本

密九云连接后，用 ssh 客户端登录堡垒机

测试环境需安装SvpnClient客户端，用 ssh 客户端登录堡垒机

data/app/项目名 下放 jenkins 打的包

## 西安

需传包后执行脚本

EasyConnect 连接后登录华为云堡垒机

data/app/ dev or prod /项目名下放 jenkins 打的包

执行 pc-dev.sh  or  pc-prod.sh  or  subapp-dev.sh  or  subapp-prod.sh 

## 苏州

执行脚本

奇安信 VPN 登录后，连接堡垒机

pc.sh

## 广西

连接 Slink 后登录堡垒机，堡垒机需要下载插件后开启代理

/root/deploy-shell 部署脚本

59.211.236.141 测试，内网转发到外网
59.211.236.142 生产，内网转发到外网

nginx 配置在 home/ansible/centos/roles 的项目下 /files

nginx 的 EIP 地址为前端访问页面的 ip + /user-center

etc/ansible/hosts 配置nginx的eip地址

## 湖北宜昌（未对接用户中心）

V5VPN 登录10.55.177.249堡垒机发布

生产环境部署
1. 检查jenkins脚本配置
2. 找到广西生产的jenkins并打包
3. vpn连接后登录生产的堡垒机
4. 检查nginx配置和hosts配置后执行脚本推送生产包

本地复制代理地址cookie，启动代理地址

1. 广西目录开发、部署
2. 陕西、苏州、西安治理相关需求定制及部署

TODO:
0. 排查用户中心基线资源404问题 ✅
1. 苏州开发环境分包资源找不到 ✅
2. 苏州目录生产环境部署 ✅
3. 广西目录开发 (段月环) 、部署 ✅
4. 苏州目录优化 
   4.1 目录明细优化 ✅
   4.2 数源部门级联筛选优化 ✅
   4.3 基础库&专题库
   4.4 基础库详情&专题库详情
   4.5 审批流
   4.6 领域分类管理-专题库目录改造
5. 用户中心相关
   5.1 广西文件上传（5.22前完成） ✅
6. 苏州：目录、门户、治理、探查、网关换头部
7. 治理相关需求
西安治理：https://dtzhejiang.yuque.com/cnntk0/gxo7eg/vewrf1hfga2tgsy2 ✅ 
苏州治理：https://dtzhejiang.yuque.com/cnntk0/gxo7eg/tf5ez1792ryr1bac ✅
陕西治理：https://dtzhejiang.yuque.com/cnntk0/gxo7eg/kkct57hcn1yw2zwo#GbxFj
泰州治理：https://dtzhejiang.yuque.com/g/cnntk0/gxo7eg/ep5gsx6332xynh4s/collaborator/join?token=o33GP8nQ5GXDWhAT&source=doc_collaborator# 《一数一源一标准产品迭代V2.7.5》
1. 首页加三个权限控制
2. 角色配置权限-后端返回这三个权限值
3. 治理规则配置页面-隐藏A001001-检验字段空值的操作按钮 ✅




1. 广西目录开发环境503? runtimePublicPath未配置，导致请求404 ✅，生产环境目录网关超时(可能需要内网转发的nginx配置调整) ✅
2. 陕西免登有问题? 部门未配置 ✅
3. 用户中心基线开发环境挂了 http升级https, oss不能升级成https, 导致报错 ✅
4. 用户中心基线subapp/sso-pc/index.html 404 ✅


q:基线的用户中心为什么请求oss
a:IS_NGINX=1 时，请求nginx资源，IS_NGINX=0 时，请求oss资源

资源请求 => uc-nginx => usercenter-nginx => subapp-nginx 

TODO:
0. 拆解门户、网关、治理的任务排期
1. 治理-西安、苏州、陕西、广西、省级看板新增老看板（可从泰州或重庆迁移）
2. 用户中心-陕西测试环境部署
3. 门户的优化改造
4. 目录-苏州等
  4.1 引用目录，基础库分类
  4.2 宜昌、泰州
  4.3 西安目录

2024.5.27
1. 苏州目录、用户中心、探查、网关头部统一组件样式 ✅
2. 部署用户中心陕西测试环境 ✅
3. 苏州目录-基础库引用目录开发 
4. 省Saas治理新增看板 ✅
5. 用户中心陕西-支持auth_code登录

2024.6.3
1. 理解归集prd ✅
2. 部署陕西治理、标准测试环境
3. 部署省Saas治理生产环境 ✅
4. 苏州目录历史上传
5. 上传陕西治理、用户中心环境 ✅
6. 部署广西归集，从基线版本拉分支
7. 广西归集替换头部组件，样式适配，本地化改造
8. 对接用户中心、门户、目录、治理
9. 省级用户中心密评改造，12号之前完成

基层工作台
1. 组件工作台开发联调部署




















## 主要工作内容
1. 交接苏州、广西、陕西、西安的部署方式，沉淀出一份部署文档，以便后来的人接手
2. 各项目区分开发环境、测试环境、生产环境，遵守部署规范，因项目中的地区简写有历史债，项目内代码保持不变，地区分支严格按照规范，并在各自的项目群公共里贴出各环境的访问路径
3. 用户中心是交付线的底层模块，容易成为各个交付线项目上的阻塞点，出现的部署问题也是最多的
总结下常见问题以及排查思路
  3.1 q: 打开白屏，且路由为/norole 或 /noauth
      a: 先检查用户的角色和权限，再排查nginx配置
  3.2 q: 作为子应用部署，报404
      a: 先检查请求的资源地址是否正确，oss迁移或资源未部署等。再排查jenkins和nginx配置是否正确，尝试重新打包，使用无痕浏览器。
  3.3 q: 作为子应用部署，报未导出生命周期函数 
      a: 先检查主应用的前端配置，再排查nginx转发配置逻辑
  3.4 q: 扫码登录报错
      a: 排查用户权限和部门是否未初始化，登录跳转地址是否有变更，如苏政优变更了几次跳转和oauth地址，后端地址可能没同步更新；广西部署是到内网上，内网转外网的nginx配置有问题等
  用户中心新增feature
  1. 账密登录、修改密码
  2. 批量导入用户、组织、用户组织
  3. 头部风格适配irs，苏州定制开发头部
  4. 苏政优登录模式优化
4. 目录的定制开发最多，特别是苏州
  4.1 数据目录改版及优化
  4.2 目录探查动态化
  4.3 基础库和专题库同步匹配数据目录，新增引用数据目录
  4.4 新增基础库、专题库的审批流
5. 治理的复杂点在于利用X6引擎绘制定制化图及图上的定制化交互，还有各地市部署时间不一致，x6有大版本更新，如省级项目仍然为v1版本，后续迭代升级需要整体回归测试整个模块。
  治理的富文本编辑器提交的时候，用dompurify特殊处理提交文本，过滤和转换掉非法字符串，防止xss攻击，编辑的时候用he转换文本，让富文本编辑器内的文字带上样式
6. 门户、探查、网关
  苏州统一头部组件，适配irs风格并加上子应用间的快捷导航，方案是由irs提供规范和标准的logo，在组件库里维护一个公共组件，子系统根据自身逻辑动态使用。其中网关项目比较特殊，其代码实现用的是vue2，且node版本只能使用node14，pnpm能匹配的版本需要用v7，用vuerafordz将react组件代码转换成vue2代码，用@babel/plugin-transform-react-jsx支持jsx语法。
  网关项目部署踩坑点如下：
  6.1 安装指定版本pnpm@v7
  6.2 pnpm私有源上有部分版本下载失败，可能是淘宝镜像上某些库的证书时间到期或失效，因此pnpm设置了两个镜像源，以szzj开头的走私有镜像源，其他的走npm官方镜像源
  6.3 --no-frozen-lockfile 忽略因package.json冻结不能更新，导致的失败
  6.4 --ignore-scripts 忽略依赖包中的scripts命令，如node-sass执行额外的install.js导致的错误

## 工作沉淀、优化、最佳实践

### 沉淀
苏州、广西、陕西、西安的部署文档

自动化项目版本升级脚本

兼容unocss语法，快速写样式，无需命名class类

### 优化
子应用sso-pc页面之前不能在本地调试，需要发布之后看效果；现在本地模拟接口返回，启用预览模式进行调试

npm 在jenkins上打包到发布需要大概3-4min，换成pnpm后打包发布需要2min，打包时间优化100%

开发环境抽离第三方库到cdn，优化代码实现，如让lodash通过tree shaking减小体积等，将bundle体积从17m降到15m

### 最佳实践
治理项目测试回归的时候历史bug较多，而且因为是多地部署、多环境分支，为了减少重复开发，从版本较成熟的cq分支切出一个bugfix分支，修复完之后合并到开发分支，让测试回归完毕，再发布测试环境和生产环境，都没问题之后，切到其他地市分支，合并bugfix分支后解决冲突，重复以上步骤。

drs-components预览修改，通过 npm link 的软链，连接到本地引用组件的项目上
``` bash
# 组件库szzj-drs-components下
npm link
# 项目下 
npm link szzj-drs-components
# 在项目下 import { DilverHeader } from 'szzj-drs-components' 即可使用本地最新代码
# 记得szzj-drs-components拉取最新代码
```

用oxlint极速扫描检查eslint的最佳实践，无配置，速度达毫秒级

开发环境上开启source-map，快速定位异常，方便调试

## 工作中发现的问题、思考、建议

ai时代来临，积极拥抱技术变更，合理使用大模型可以极大提升程序员的下限

