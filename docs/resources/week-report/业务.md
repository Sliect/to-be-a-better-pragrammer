## 家政用户（365）平台

实名认证(人脸识别)

未认证 -> 浙里办下载 -> 激活 -> 采集人脸 -> 我的授权

身份证信息 居住证户口信息

## 后台管理系统

应用管理

API 管理

授权配置管理

场景数据管理

## 浙教钉

目标： 跨组织找人难，拆分g/b/c端，线下业务移植到线上，享受大数据的便利，便于沟通和监管 
1. 选择嫁接浙政钉通讯录和钉钉家校通讯录的页面 
2. 基于大数据，识别不同的用户画像 


1. 通讯录
2. 用户中心  
平台化？/产品化？ 
家庭医生 医共体 
3. 应用中心


一期MVP内容 TODO: 
1. 后台管理  
- 用户管理中心
  - 组织绑定：教育部门和学校管之间的绑定    
- 应用管理中心
  - 应用管理：钉钉上架应用管理
  - 门户管理：不同地区范围显示不同门户内容

2. 浙教钉通讯录  
教育厅-学校-人员树结构

金华和衢州 用户中心

## 开放域

政府内部数据开放到社会



DONE:

1. 后台管理联调

2. 钉钉h5静态

流程   
政务钉钉 通过免登api获取 coed => 传递authCode验证权限 => h5应用内部


本周工作  
修复bug，整理下一期的页面内容  
下周工作  
根据设计稿做静态页面  


# 后台管理中心

1. 组织节点装卸到浙教钉
2. 组织/员工查看 
  组织节点查看  
  家校通讯录查看  
  员工查看（不包括学生家长）  
3. 接口权限页面（入口为应用管理）
  

树不重新加载 递归树更改当前节点的状态  例：解绑后两侧树状态更改。遍历左右两棵树的对应节点更改其状态，重新赋值；挂载。遍历右侧节点及其子节点更改其绑定关系，重新赋值，教钉找到对应节点增加其子节点并更改其状态；删除：最复杂，两侧数据重新请求？；找不到就算了    
重点：返回状态前不能点击树结构      
子节点有绑定关系 不支持挂载  
接口权限不能全部为空，范围必选  
横向样式变形？加一个长点的宽度  


## 银保监

银行 => 银保监（金综） => 数浙（合规检查:脱敏） => 公共数据平台  

pages  
应用管理 
第三方来源管理
来源API列表  
出口API列表  
脱敏  

TODO:
应用管理列表
  添加脱敏字段，新增和编辑添加分步 
  抽象分步对话框 
  table中的expandedRowRender字段可以自定义收缩的扩展内容
第三方来源管理 列表增改查页面  
脱敏服务  列表增改查页面 详情页需要按类型显示不同规则  

权限管理
菜单管理
项目管理




step2
  mainCombine(外层树)

  modal(新增)
    按钮选择
    mainCombine(内层树)

  modal(编辑)
    mainCombine(内层树)


10号前部署一套 前置依赖


会议纪要
1. 函数组件和类组件的区别，render props，hoc高阶组件，hooks
2. 链表：单向、双向、环状链表，通过链表结构可以使fiber的增删效率更高
3. react采用current树和workInProgress树作为当前和下一帧计算的树，双缓存机制可以使页面不白屏
4. hooks的优势：更优雅的抽离业务逻辑
5. fiber，hooks，react更新机制源码解析
6. hooks最佳实践
7. 坏代码的味道
8. useForm代码实现
9. szzj/hooks 作为一个前端库共同维护使用，推荐以@umijs/plugin-model的方式公用






### OTS加密

健康码加密  









dfh-op-pc 后台管理系统，以及合作方微应用开发

浙教钉参与开发后台管理系统以及小程序h5应用开发

银保监脱敏项目

井冈山项目G端独立开发，以及B端和大屏项目辅助开发

疫情防控项目PC+APP两端，以及健康码小程序辅助开发

除了井冈山项目的G侧是从头到尾独立开发，其它项目大多是扮演中期介入到后期托底承接的角色








1. 公司架构，使命，愿景
平台赋能政府、企业、群众以数字化能力
2. 防疫系统业务知识









1. 自我介绍
来到数浙两年半了，先是参与网关、合作方、脱敏的后台管理系统的开发，然后辗转浙教钉、井冈山、疫情防控项目。

2. 项目总结
井冈山G端：权限系统，政策及细则的制定，政策拆解到原子条款，政策推演
权限系统：有超管、部门管理员、普通用户三个基准角色类型，给角色一个命名和描述，比如测试超管，然后会展示树状的菜单，在上面勾选确认后即确认了角色的页面权限范围。最后把创建的角色赋予给用户。
菜单管理：每一个菜单可视为一条数据，有表示顺序的序号、路由、是否启用的状态、是否新窗口打开、是否外链等属性，一级菜单和二级菜单形成父子关系。
政策和细则既支持上传也支持手动生成，拆解成原子条款后，逐个匹配对应的奖励，也可以在政企匹配中全局匹配
政策推演：将满足条件的细则测算，推演覆盖的企业数和奖励数额，其中奖励条件的推演是类似sql语句的生成，需要指标、操作符和条件数值，也可以模拟首次达、排除等组合条件
一些统计报表，比如根据政策查兑付的企业数和金额，或者根据企业查兑付的次数和金额

难点：政策推演的编辑
首先需要分四步走
其次需要手动实现一个平铺的树状列表，每一条匹配规则分单独匹配和组合匹配，单独匹配中不同的指标对应不同的操作符条件，不同的指标和操作符又对应不同的条件数值，组合匹配又是一个平铺的组合，比如营业额在2022年首次到达1000万，需要指标匹配+时间匹配，且还要进行完整性校验，至少一条，如果是空的匹配则忽略
因为匹配的规则繁杂琐碎，为了方便，在进步骤前转换成前端格式，提交给后端前再转换成后端格式，这样也不用担心后端随时改字段

防疫系统的难点：高频迭代导致的逻辑变动频繁，比如协查相关的字段在协查模块、病例管理、重点人员中都用到了，抽象成单独的组件放到entities下，作为业务组件公用，对业务模块集中管理；
历史债：导致多套方案同时存在，既有后端也有前端
两端公用：抽象公用逻辑的组件库

例子：弹窗添加debounce，先是考虑弹窗控制的 useModal 能否添加，再考虑请求 useAsync, useFetch 上能否添加，最后万事不决加抽象，在 antd 的 Modal 上加一层封装，单独对提交的 onOk 函数 debounce 处理，为了严谨考虑，因为 Modal 上可以改变 footer 按钮，所以还要全局搜索看有没有自定义的按钮，最后还要把 Modal 上的静态方法注入上去

3. 职业规划

站在公司的角度需要什么样的技术能力，大屏、地图？

4. 主营业务

平台赋能政府、企业、群众以数字化能力






余杭一体化工作台

- 首页
  - 轮播条
  - 待办中心 （不同第三方来源的待办事项，可跳转处理）
  - 我的日程 （日程管理，发起、接收、拒绝、修改、取消会议，可签到）
  - 数据看板 （第三方静态页面）
  - 智能提醒 （退休人员出院、企业外迁两种智能提醒）
  - 查数据 （可通过企查查或企业综合服务平台查企业，加了权限控制；跳转已申请数据的详情页）
  - 进应用 （应用分类展示，可跳转）
  - 快捷入口（第三方快捷跳转）
- 街道数据资源 （数据资源申请、审批）
  专题数据：申请部门员工 => 申请部门领导审批通过 => 数管办审批通过 => 已申请数据列表页
  自有数据：申请部门员工 => 申请部门领导审批通过 => 数源单位审批通过 => 数管办审批通过 => 已申请数据列表页
- 我的数据
  - 已申请数据：
  - 自有数据：上架、下架自有数据
- 权限管理
  - 用户管理 （给用户赋予角色）
  - 角色管理 （给角色赋予权限，给单个角色批量设置用户）
  - 权限管理 （菜单配置，给菜单配置权限）


问题复现
1. 打包后的文件设置 publicPath 和 sourceMap 后部署在Oss上
2. IRS上部署的html加载指向Oss上的 umi.js
3. 日程牵头部门DeptTransferTextarea 在onChange中调用form.setFieldsValue({ deptCodes }) 会卡死，无法进行任何操作，且无报错;
   发起部门的 onChange中调用form.setFieldsValue({ deptCodes })不会卡死，但是如果参会部门有值，再去调用 setFieldsValue就会卡死；
   小结：form.setFieldsValue({ deptCodes }) 在deptCodes有树节点的值时，会卡死
4. 断点显示在 react-dom 的 accumulateSinglePhaseListeners 函数中死循环；
   推测：可能是在事件分发过程中，如果事件监听器在触发期间又修改了组件树或触发了其他事件，导致死循环
5. 去除掉所有多余的表单字段，断点调试 发现 rc-util 的 merge 也会死循环，把 DeptTransfer 的多余字段都删了，clone 的时候就不会死循环

尝试解决：
1. 改变deptCodes值
2. setTimeout
3. 只留发起部门和参会部门
4. react版本
5. rc-util 的 merge 方法死循环，减少clone字段 (成功)



2023.8.7-2023.8.11
1. 待办来源加上统计值（8.8已发布）
2. irs虚拟部署 (测试环境已替换，正式环境待下次发布时替换)
3. 增加浙政钉扫码页，逻辑改造后便于浏览器环境端远程调试oss部署代码
4. oss部署：日程回复时，添加非浙政钉人员无效；发现其表单值没有更新，使用手动重绘组件更新后解决
5. 一体化工作台PC端和移动端埋点，统计各模块访问量
6. 代码优化：用keep-alive公共组件包裹进行缓存，但是因为Modal是通过 createProtal 挂载在document.body下，而不在Provider下，无法消费共享数据，所以该优化暂延
7. 代码优化：下载用 @szzj/utils 和 @szzj/request 替换，库的实现逻辑还有问题   

2023.8.14-2023.8.18
1. 埋点发布（8.17），pc和移动端已从irs部署改成oss部署
2. utils组件库增加 tree 的操作方法和其单元测试
3. 代码优化：文件流下载用 AttachmentMiddleware 替换
4. hooks库中 filter 方法bugfix，并添加单元测试

2023.8.21-2023.8.27
1. 授权端：授权列表模块开发；页面适老化；
2. 基层工作台PC端: 日程优化；市民卡核验；简道云对接；
3. 基层工作台移动端: 日程优化；
4. Op端：授权运营申请详情模块开发；

2023.8.28-2023.9.1
1. 授权域 op、授权端项目联调、bugix

OP：切换 Hosts 网关登陆（地址a）后，获取cookie，切换回本地代理（地址a），浏览器（地址a+代理服务器端口）访问
授权端：


问题：
1. 切换tab导致列表页回到待授权列表  usePageShow换成useEffect
2. 详情样式有问题                  className不会自动转成驼峰类
3. 跳转人脸识别                   



1. Op端  证件PDF预览
2. Op端  字段更新
3. 浙里办授权联调




1. 扫脸后跳转结果页，但是不带url参数
2. 人脸识别失败后唤不起人脸识别      
  2.1 登陆人脸识别失败，如何再次唤起
  2.2 人脸识别必须先要有实名认证，如果没有实名认证？



1. 基层智治平台优化，具备上线条件
2. 授权端优化



1. 基层工作台残疾人模块，人员离开部门判断
2. IAM 页面开发


issues:
1. 文件预览
2. 统计时间


左三
1. 后三个异常待补充
2. 前三个详情页待补充
3. 后两个列表待联调
4. 列表页优化


1. 一本账新增用户管理模块，扫码登陆的参数从后端获取
2. IAM 开发联调省重点接口管理模块和对账中心模块


1. jest 断点调试
2. immer 源码：如何实现对象的代理
3. Tree 组件内部如何用 immer 实现树的不可变 
``` ts
const baseTree = new Tree(data);
baseTree
```
4. 树的不可变（有什么意义？保留历史回溯？）



1. jest 断点调试 immerjs 源码
2. 一本账文件下载联调
3. 授权域发布



1. 杭宁温权限隔离
2. header头里加 DATA-RANGE
